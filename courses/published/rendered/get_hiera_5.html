<link rel="stylesheet" href="/static/selfpaced/selfpaced.css" />

<div id="lesson">

  <div id="instructions">

    <div class="instruction-header">
<i class="fa fa-graduation-cap"></i>
</div>

    <div class="instruction-content">

      <p>Now that we&#8217;ve seens what possible with complex hierarchies, let&#8217;s take a look
at some other ways of interacting with Hiera data. What if you want to combine
data from multiple levels of the hierarchy?</p>

      <p>For example, you have a list of software packages that you want installed on
every server and some that depend on the environment. If you had to specify
that at every level of the hierarchy it would lead to a lot of duplicate data.</p>

      <p>Thankfully, Hiera is more intelligent than that. Let&#8217;s look at how this could
play out in a hierarchy with three levels. At the top, we have the per-node
configuration. Let&#8217;s just set one up for Bob&#8217;s dev server in
&#8216;nodes/bob.puppetlabs.vm.yaml&#8217;:</p>
      <pre>
---
package_list:
  - emacs
</pre>

      <p>All of the other developers use vim, so let&#8217;s make sure the development.yaml
has that package along with some other useful things:</p>
      <pre>
---
package_list:
  - vim
  - gcc
  - cowsay
</pre>

      <p>But in production, we don&#8217;t want anything extra, so instead of vim we&#8217;ll just
have vi and leave out the other packages:</p>
      <pre>
---
package_list:
  - vi
</pre>

      <p>Finally, at the bottom of the hierarchy we have a few packages that should be
installed on every machine in common.yaml:</p>
      <pre>
---
package_list:
  - dig
  - ssh
  - fortune
</pre>

      <p>Unfortunately, using the <code>hiera()</code> function will only return the result from a
single level in the hierarchy. To correctly merge across multiple levels of the
hierarchy, we&#8217;ll need to use <code>hiera_array()</code>:</p>

      <pre>
$packages = hiera_array('package_list')
package { $packages:
  ensure =&gt; present,
}
</pre>

      <p>The best way to understand <code>hiera_array()</code> is to just dig in and try it out.
It&#8217;s pretty easy to test by using the command line <code>hiera</code> tool, just use the
<code>-a</code> argument. For example to see what packages are installed on Bob&#8217;s dev
machine you would use this command:</p>
      <pre>
hiera -a package_list environment=development certname=bob.puppetlabs.vm.yaml
</pre>

      <p>and the result would be:</p>
      <pre>
["fortune","dig","ssh","vim","gcc","cowsay","emacs"]
</pre>

    </div>
    <div class="instruction-header">
<i class="fa fa-desktop"></i>
</div>
    <div class="instruction-content">

      <p>We&#8217;ve set up these example files and a few more on the practice machine, try a
few permutations until you have a feel for how hiera_array() works.</p>

    </div>

    <p><a href="https://try.puppet.com/sandbox/?course=get_hiera5" class="btn btn-default" target="terminal">Start Practice Session</a></p>

  </div>

  <div id="terminal">
  <iframe name="terminal"></iframe>
</div>

</div>
